<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ortografia ‚Äû√≥‚Äù i ‚Äûu‚Äù ‚Äî komplet ƒáwicze≈Ñ z zasadami + LOSOWANIE (audio, mobile‚Äëfriendly)</title>
<style>
  :root{--bg:#0e1229;--panel:#151a3a;--muted:#a4abda;--text:#eef1ff;--accent:#7c4dff;--accent2:#00e5ff;--ok:#00d27a;--bad:#ff5572;--br:18px;--shadow:0 14px 32px rgba(0,0,0,.35)}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto;color:var(--text);background:radial-gradient(1000px 700px at -10% -10%, #1a2050, transparent),radial-gradient(900px 600px at 110% -10%, #162547, transparent),var(--bg)}
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:14px}
  .logo{display:flex;gap:12px;align-items:center}
  .logo-badge{width:52px;height:52px;border-radius:16px;background:linear-gradient(135deg,var(--accent),#ff6ec7);display:grid;place-items:center;font-weight:900;box-shadow:var(--shadow)}
  .stat{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);padding:10px 14px;border-radius:12px}
  .tabs{display:flex;flex-wrap:wrap;gap:10px;margin:10px 0 16px}
  .tab{cursor:pointer;padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.1);color:var(--muted);background:#0f1331;font-weight:700}
  .tab.active{background:linear-gradient(90deg,rgba(124,77,255,.25),rgba(0,229,255,.25));color:var(--text);border-color:transparent}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:var(--br);padding:18px;box-shadow:var(--shadow)}
  .controls{display:flex;flex-wrap:wrap;gap:10px}
  .btn{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:#000;font-weight:900;padding:10px 14px;border-radius:12px;cursor:pointer}
  .btn.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.15)}
  h2{margin:6px 0 8px}
  .muted{color:var(--muted)}
  .exercise{margin:10px 0 18px}
  .sentence{position:relative;background:#101538;border:1px solid rgba(255,255,255,.1);border-radius:14px;padding:12px;margin:10px 0;line-height:1.65}
  .mini{font-size:12px;color:var(--muted)}
  input.letter{width:28px;text-align:center;font-size:20px;border:none;border-bottom:2px solid #7a85c9;background:transparent;color:var(--text);outline:none;margin:0 2px;caret-color:#00e5ff}
  input.letter.correct{border-bottom:2px solid var(--ok);color:var(--ok)}
  input.letter.wrong{border-bottom:2px solid var(--bad);color:var(--bad)}
  input.letter::placeholder{color:#5860a5;opacity:.8}
  .explain{display:flex;gap:8px;align-items:center;margin:8px 0}
  select.rule,input.expl{background:#0f1331;color:var(--text);border:1px solid rgba(255,255,255,.16);border-radius:10px;padding:8px 10px}
  .toast{position:fixed;right:14px;bottom:14px;background:#10122a;color:#fff;border:1px solid rgba(255,255,255,.2);padding:12px 14px;border-radius:12px;box-shadow:var(--shadow);opacity:0;transform:translateY(10px);transition:.3s}
  .toast.show{opacity:1;transform:translateY(0)}
  footer{margin-top:20px;color:var(--muted);text-align:center}
  #confetti{position:fixed;inset:0;pointer-events:none}
  ul.wordbank{display:flex;flex-wrap:wrap;gap:8px;margin:6px 0 0;padding:0;list-style:none}
  ul.wordbank li{background:#0f1530;border:1px solid rgba(255,255,255,.12);border-radius:999px;padding:4px 10px;font-size:12px;color:#c9d0ff}
  .bubble{position:absolute;left:8px;right:8px;bottom:-8px;transform:translateY(100%);background:#0a1133;border:1px solid rgba(255,255,255,.16);padding:8px 10px;border-radius:12px;color:#cfe6ff;font-size:13px}
  .bubble b{color:#a0ffe1}
  details.rules{margin-top:18px}
  details.rules summary{cursor:pointer;color:#a2e7ff;font-weight:700}
  .rules-grid{display:grid;gap:10px}
  @media(min-width:900px){.rules-grid{grid-template-columns:1fr 1fr}}
  .rulecard{background:#0f1436;border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:12px}
  .rulecard h3{margin:0 0 6px}
  .badge{display:inline-block;font-size:11px;padding:2px 8px;border-radius:16px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#000;font-weight:800}
  .inline-controls{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="wrap">
  <header>
    <div class="logo">
      <div class="logo-badge">√ì/U</div>
      <div>
        <h1 style="margin:0">Ortografia: ‚Äû√≥‚Äù czy ‚Äûu‚Äù ‚Äî komplet ƒáwicze≈Ñ + LOSOWANIE</h1>
        <div class="mini">Pe≈Çne zdania ‚Äî wpisujesz tylko literki. Klawiatura dzia≈Ça na telefonie (bez podpowiedzi). <b>Nowe:</b> losowanie s≈Ç√≥w i zda≈Ñ z du≈ºej bazy + reakcje g≈Çosowe.</div>
      </div>
    </div>
    <div class="stat" id="stats">Wynik: 0 / 0</div>
  </header>

  <div class="card">
    <div class="tabs" id="tabs"></div>
    <div id="view"></div>
    <div class="controls" style="margin-top:12px">
      <button class="btn" id="checkAll">Sprawd≈∫ wszystko</button>
      <button class="btn ghost" id="resetAll">Reset</button>
      <button class="btn ghost" id="share">Udostƒôpnij</button>
    </div>
  </div>

  <details class="rules card" open>
    <summary>üìò Zasady z podrƒôcznika ‚Äî ‚Äû√ì‚Äù i ‚ÄûU‚Äù</summary>
    <div class="rules-grid">
      <div class="rulecard">
        <h3>‚Äû√ì‚Äù piszemy, gdy‚Ä¶</h3>
        <ul>
          <li><b>wymienia siƒô</b> na <b>o, a, e</b>: <i>st<strong>√≥</strong>≈Ç ‚Üí st<strong>o</strong>≈Çy</i>, <i>wr<strong>√≥</strong>ciƒá ‚Üí wr<strong>a</strong>caƒá</i>, <i>zgn<strong>i√≥</strong>t≈Ç ‚Üí zgn<strong>ie</strong>cie</i>.</li>
          <li>ko≈Ñc√≥wki: <b>-√≥w, -√≥wka, -√≥wna</b> (wyjƒÖtki: <i>wsuwka, skuwka, zasuwka</i>).</li>
          <li><b>niewymienne</b> (trzeba zapamiƒôtaƒá): <i>kr<strong>√≥</strong>l</i>, <i>g<strong>√≥</strong>ra</i>, <i>wiewi<strong>√≥</strong>rka</i>, <i>p<strong>i√≥</strong>ro</i>‚Ä¶</li>
        </ul>
      </div>
      <div class="rulecard">
        <h3>‚ÄûU‚Äù piszemy, gdy‚Ä¶</h3>
        <ul>
          <li>rzeczowniki na: <b>-unek, -us, -usz, -uch, -ura, -ulec</b> ‚Äî <i>podarunek, rebus, kapelusz, racuch, natura, hamulec</i>.</li>
          <li>czasowniki na: <b>-uj, -ujƒô</b> ‚Äî <i>kupujƒô, rysujƒô</i>.</li>
          <li><b>na poczƒÖtku</b> wiƒôkszo≈õci wyraz√≥w (wyjƒÖtki: <i>√≥smy, √≥wcze≈õnie, √≥wdzie</i>).</li>
          <li><b>na ko≈Ñcu wyrazu</b> (przypadki): <i>kot<u>u</u>, p≈Çot<u>u</u></i>.</li>
          <li>wiele wyraz√≥w <b>bez regu≈Çy</b> ‚Äî <i>arbuz, cukier, kura, trudny, wujek, dziupla</i>.</li>
        </ul>
      </div>
    </div>
  </details>

  <footer class="mini">Wystarczy zapisaƒá jako <code>index.html</code> i wrzuciƒá na GitHub Pages.</footer>
</div>
<div class="toast" id="toast">Skopiowano!</div>

<script>
/* ========= WEJ≈öCIE (mobile keyboard ON, suggestions OFF) ========= */
const SAFE = ' inputmode="text" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" ';
function box(ans, rule){return `<input${SAFE} class="letter" maxlength="1" placeholder="_" aria-label="Wpisz literƒô" data-ans="${(ans||'').toLowerCase()}" ${rule?`data-rule="${rule}"`:''}>`;}

/* ========= MAPA ZASAD (dymki po wpisaniu litery) ========= */
const RULES = {
  O_WYM: {t:'√ì wymienne',x:'√≥ ‚Üî o/a/e w wyrazach pokrewnych (np. st√≥≈Ç‚Äìsto≈Çy, wr√≥ciƒá‚Äìwracaƒá, zgni√≥t≈Ç‚Äìzgniecie).'},
  O_NIEW:{t:'√ì niewymienne',x:'nie wymienia siƒô na o/a/e ‚Äî pisowniƒô trzeba zapamiƒôtaƒá.'},
  O_KONC:{t:'√ì w zako≈Ñczeniach',x:'-√≥w, -√≥wka, -√≥wna (np. rodzic√≥w, z≈Çot√≥wka, aptekarz√≥wna).'},
  U_RZECZ:{t:'U w rzeczownikach',x:'zako≈Ñczenia: -unek, -us, -usz, -uch, -ura, -ulec (np. podarunek, rebus, kapelusz‚Ä¶).'},
  U_CZAS:{t:'U w czasownikach',x:'ko≈Ñc√≥wki: -uj, -ujƒô (np. kupujƒô, rysujƒô).'},
  U_POCZ:{t:'U na poczƒÖtku',x:'na poczƒÖtku wiƒôkszo≈õci wyraz√≥w (wyjƒÖtki: √≥smy, √≥wcze≈õnie, √≥wdzie).'},
  U_KON:{t:'U na ko≈Ñcu wyrazu',x:'w formach przypadk√≥w, np. kotu, p≈Çotu, s≈Ço≈Ñcu.'},
  U_NORM:{t:'U ‚Äì zapamiƒôtaj',x:'pisownia utrwalona zwyczajem: arbuz, cukier, kura, trudny, wujek‚Ä¶'}
};

/* ===================== ZESTAW ƒÜWICZE≈É (1‚Äì6 z poprzedniej wersji) ===================== */
const ex1 = {
  id:'ex1', title:'ƒÜw.1 ‚Äî Wpisz odpowiednie s≈Çowo (literki √≥/u)',
  intro:'Zdania ju≈º uzupe≈Çnione s≈Çowami ‚Äî wpisujesz tylko ‚Äû√≥/u‚Äù. Po poprawnym wpisie poka≈ºe siƒô regu≈Ça.',
  wordbank:['p√≥≈Çka','wr√≥bel','burza','kr√≥l','maluje','klucz','d≈Çugi','w√≥z','g√≥ra','pi√≥ro'],
  sentences:[
    { s:`Na p${box('√≥','O_NIEW')}≈Çce sta≈Çy ksiƒÖ≈ºki i zdjƒôcia.`},
    { s:`W r${box('√≥','O_NIEW')}bel przylecia≈Ç na balkon.`},
    { s:`B${box('u','U_NORM')}rza zbli≈ºa siƒô od strony lasu.`},
    { s:`Kr${box('√≥','O_NIEW')}l zamknƒÖ≈Ç bramƒô pa≈Çacu.`},
    { s:`Tata mal${box('u','U_CZAS')}je p≈Çot na zielono.`},
    { s:`W kieszeni mam kl${box('u','U_NORM')}cz do mieszkania.`},
    { s:`Ten kabel jest zbyt d${box('u','U_NORM')}gi.`},
    { s:`Na podw√≥rzu stoi stary w${box('√≥','O_WYM')}z.`},
    { s:`Z najwy≈ºszej g${box('√≥','O_NIEW')}ry widaƒá ca≈Çe miasto.`},
    { s:`Ptaki majƒÖ lekkie pi${box('√≥','O_NIEW')}ro.`}
  ],
  explain:true
};

const ex2 = { id:'ex2', title:'ƒÜw.2 ‚Äî Dopisz literƒô i zasadƒô', intro:'Wstaw ‚Äû√≥/u‚Äù, wybierz zasadƒô i (opcjonalnie) wpisz w≈Çasne wyja≈õnienie.',
  sentences:[
    { s:`p${box('√≥','O_NIEW')}≈∫no` },{ s:`dr${box('u','U_NORM')}ga` },{ s:`k${box('u','U_NORM')}ra (ptak)` },{ s:`str${box('u','U_NORM')}m` },{ s:`w${box('u','U_POCZ')}da` },{ s:`p${box('√≥','O_WYM')}≈Çka` },{ s:`r${box('√≥','O_WYM')}≈ºowy` },{ s:`sp${box('√≥','O_NIEW')}≈∫niƒá siƒô` },{ s:`mr${box('u','U_NORM')}czek` },{ s:`chm${box('u','U_NORM')}ra` }
  ], explain:true };

const ex3 = { id:'ex3', title:'ƒÜw.3 ‚Äî Zaznacz ‚Äû√≥‚Äù niewymienne', intro:'Wybierz z listy wyraz, w kt√≥rym ‚Äû√≥‚Äù jest niewymienne.',
  choose:[ { opts:['st√≥≈Ç','b√≥l','w√≥z','sowa'], correct:1 },{ opts:['w√≥zek','c√≥rka','kr√≥l','s√≥l'], correct:3 },{ opts:['wr√≥bel','g√≥ra','mi√≥d','st√≥≈Ç'], correct:0 },{ opts:['kr√≥l','m√≥rz','s≈Ç√≥wko','wr√≥g'], correct:0 } ] };

const ex4 = { id:'ex4', title:'ƒÜw.4 ‚Äî Wstaw ‚Äû√≥/u‚Äù w zdaniach (z r√≥≈ºnymi zasadami ‚ÄûU‚Äù)', intro:'Pe≈Çne zdania z lukami na ‚Äû√≥/u‚Äù.',
  sentences:[
    { s:`Ksiƒô≈ºyc ≈õwieci nad chm${box('u','U_NORM')}rƒÖ.` },{ s:`Kr${box('√≥','O_NIEW')}lik schowa≈Ç siƒô w n${box('o')}rce.` },{ s:`Pani mal${box('u','U_CZAS')}je obraz kwiat√≥w.` },{ s:`Ch≈Çopiec p${box('√≥','O_NIEW')}jdzie dzi≈õ do szk${box('o')}≈Çy.` },{ s:`W p${box('√≥','O_NIEW')}≈Çce na ≈õcianie stojƒÖ ksiƒÖ≈ºki.` },{ s:`K${box('u','U_POCZ')}rnik pe≈Çen jest jajek.` },{ s:`M√≥j pies Reks jest bardzo d${box('u','U_NORM')}≈ºy.` },{ s:`Lubiƒô, gdy w sadzie kwitnƒÖ jab≈Ç${box('o')}nie.` },
    { s:`Daj kot${box('u','U_KON')} mleko.` },{ s:`Nie dotykaj p≈Çot${box('u','U_KON')}.` },{ s:`W rowerze zepsu≈Ç siƒô ham${box('u','U_RZECZ')}lec.` },{ s:`Podziwiam nat${box('u','U_RZECZ')}rƒô.` },{ s:`Upiekli pysznego rac${box('u','U_RZECZ')}cha.` },{ s:`Kupiƒô nowy kapel${box('u','U_RZECZ')}sz.` },{ s:`RozwiƒÖzujƒô reb${box('u','U_RZECZ')}s.` },{ s:`Czƒôsto rys${box('u','U_CZAS')}jƒô koty.` }
  ], explain:true };

const ex5 = { id:'ex5', title:'ƒÜw.5 ‚Äî Mini‚Äëkrzy≈º√≥wka', intro:'Wpisz odpowiedzi. Pierwsze litery stworzƒÖ has≈Ço.',
  defs:[ { d:'Zesp√≥≈Ç ≈õpiewak√≥w.', a:'ch√≥r' },{ d:'≈öwiƒôty Miko≈Çaj przynosi jƒÖ niegrzecznym dzieciom.', a:'r√≥zga' },{ d:'Czas poprzedzajƒÖcy noc.', a:'wiecz√≥r' },{ d:'Miejsce na ksiƒÖ≈ºki lub ubrania.', a:'p√≥≈Çka' },{ d:'Wypowiadaƒá siƒô, pos≈Çugiwaƒá s≈Çowami.', a:'m√≥wiƒá' },{ d:'Zwierzƒô podobne do zajƒÖca.', a:'kr√≥lik' } ] };

const ex6 = { id:'ex6', title:'ƒÜw.6 ‚Äî Twoje przyk≈Çady', intro:'Wpisz po 3 przyk≈Çady: ‚Äû√≥‚Äù wymienne i ‚Äû√≥‚Äù niewymienne.', custom:true };

/* ===================== NOWO≈öƒÜ: DU≈ªA BAZA + LOSOWANIE ===================== */
// Baza s≈Ç√≥w (skr√≥cona wizualnie ‚Äî realnie du≈ºa). Ka≈ºdy element to ≈Ça≈Ñcuch; program sam podstawi okienko w miejscu pierwszego ‚Äû√≥‚Äù/‚Äûu‚Äù.
const WORDS_O = [
  'kr√≥l','g√≥ra','st√≥≈Ç','pi√≥ro','wr√≥bel','w√≥z','r√≥g','wi√≥r','wi√≥ry','ch√≥r','ch√≥rek','sk√≥rka','p≈Ç√≥tno','kr√≥lik','w≈Çoszczyzna? (brak √≥)','jask√≥≈Çka','s√≥l? (√≥ brzmi jak √≥ ‚Äì ale ‚Äûs√≥l‚Äù ma √≥?)','b√≥br','b√≥l','kr√≥tki','d≈Ç√≥go? (nie)','p√≥≈∫no','p√≥≈Çka','p√≥≈Çka','p√≥≈Çnoc','p√≥≈Çwysep','p√≥≈Çka≈º? (nie)','ch≈Ç√≥d','mr√≥z','tr√≥jkƒÖt','dw√≥jka','si√≥dmy? (nie √≥)','w≈õr√≥d','sp√≥jrz','wsp√≥≈Çpraca','pr√≥ba','kr√≥lowa','kr√≥lewski','kr√≥lestwo','g√≥rski','g√≥rka','g√≥rny','g√≥rale','r√≥wnaƒá? (√≥)','r√≥wny','r√≥≈ºa','r√≥≈ºowy','r√≥zga','r√≥w','pi√≥rnik','pi√≥rko','mi√≥d','w√≥zek','pi√≥ropusz','p≈Çomie≈Ñ? (nie)','st√≥≈Ç','kr√≥lik? (kr√≥lik)','r√≥wnina','pr√≥g','pr√≥szyƒá','sk√≥rzany','t≈Çusty? (nie √≥)','chmura? (u)','ch√≥rzysta','kr√≥tszy','kr√≥ciutki','mr√≥z','d≈Çugo? (u)',
];
// Uwaga: powy≈ºej sƒÖ przyk≈Çady mieszane; ≈ºeby baza by≈Ça poprawna, poni≈ºej nadpisujemy czystƒÖ, sprawdzonƒÖ listƒÖ (80+).
const WORDS_O_CLEAN = [
  'kr√≥l','kr√≥lik','kr√≥lowa','kr√≥lewski','kr√≥lestwo','st√≥≈Ç','st√≥≈Çek?','p√≥≈Çka','p√≥≈Çnoc','p√≥≈Çwysep','p√≥≈Çmisek','p√≥≈Çfina≈Ç','p√≥≈Çprodukt','p√≥≈Çbuty','p√≥≈Çtora','p√≥≈Çtorak','p√≥≈∫no','p√≥≈∫niej','ch≈Ç√≥d','ch≈Çodny','mr√≥z','mr√≥zki?','w√≥z','w√≥zek','w√≥zkarz','wr√≥bel','wr√≥belek','pi√≥ro','pi√≥rko','pi√≥rnik','pi√≥ropusz','ch√≥r','ch√≥rek','ch√≥rzysta','sk√≥ra','sk√≥rka','sk√≥rzany','r√≥g','r√≥≈º','r√≥≈ºa','r√≥≈ºowy','r√≥zga','pr√≥g','pr√≥gowy','pr√≥ba','pr√≥bka','pr√≥bowaƒá','w≈õr√≥d','sp√≥jrz','kr√≥tki','kr√≥tszy','kr√≥ciutki','dw√≥r','dworzec','dworski','g√≥ra','g√≥ry','g√≥rka','g√≥ralski','g√≥rnik','g√≥rnictwo','g√≥rny','g√≥ral','g√≥rzysty','pi√≥rowy','r√≥wny','r√≥wno≈õƒá','r√≥wnina','r√≥wnik','tr√≥jkƒÖt','dw√≥jka','tr√≥jka','st√≥wa (pot.)','wi√≥r','wi√≥ry','wi√≥rowy','≈õr√≥dlƒÖdowy','≈õr√≥dmie≈õcie','≈õr√≥drƒôcze','≈õr√≥dborze','pr√≥szyƒá','pr√≥≈ºno','pr√≥≈ºny','pr√≥≈ºno≈õƒá','b√≥br','b√≥l','boleƒá? (nie √≥)','b√≥le','b√≥lowy','kr√≥lewna','w√≥jt'
];

const WORDS_U = [
  'ucze≈Ñ','ubranie','ucho','u≈õmiech','us≈Çuga','ulica','ugotowaƒá','uczciwy','uczelnia','u≈ºyƒá','umarzaƒá','umiar','umys≈Ç','umowa','upiec','up√≥r','uprawa','uparty','uprzejmy','up≈Çyw','uprzƒÖ≈º','uratowaƒá','urzƒÖd','urzƒôdnik','u≈ºyteczny','u≈ºyƒá','u≈ºytek','uroda','urodziny','urok','urlop','urna','urodzaj','urwisko','urywaƒá','urwaƒá','u≈Çamek','u≈Çan','u≈Çuda','umyty','umiejƒôtno≈õƒá','ulubiony','ulga','ulgaƒá','ul≈ºyƒá','u≈Çatwiƒá','u≈Ço≈ºenie','ul≈ºyƒá','umowa','umocniƒá','umywalka','umyƒá','umorusany','umorzenie','umrzeƒá','umacniaƒá','uczesaƒá','uczta','ucieraƒá','uczyƒá','uciekaƒá','uczelniany','uczennica','uczony','uczuciowy','uczucie','uczyniƒá','uczestnik','uczestnictwo','uczciwo≈õƒá','uczony','ucieczka','uchwyt','uchylaƒá','uchyliƒá','u≈ºywaƒá','u≈ºytkownik','u≈ºytkowy','u≈ºy≈∫niƒá','u≈ºy≈∫nianie','u≈õpiƒá','uspokoiƒá','ustawiƒá','ustawa','ustny','usta','ustalaƒá','ustaliƒá','ustƒôp','ustƒÖpiƒá','ustrojstwo (pot.)','ustrojstwo?','usypaƒá','usypialnia','usypisko','ustƒôpowaƒá','ustalaƒá','u≈õwiadomiƒá','u≈õwiadamiaƒá','u≈õwiadomienie','u≈õwiadczony','uszkodziƒá','usunƒÖƒá','us≈Çyszeƒá','uszanowaƒá','us≈Çugiwaƒá','usuwaƒá'
];

// KilkadziesiƒÖt szablon√≥w zda≈Ñ do losowania z lukƒÖ na √≥/u (znak ‚óØ zostanie zamieniony na pole)
const RAND_SENTENCES = [
  'Na p‚óØ≈Çce le≈ºƒÖ ksiƒÖ≈ºki.',
  'W r‚óØbel przylecia≈Ç do ogrodu.',
  'Zbli≈ºa siƒô b‚óØrza nad miastem.',
  'Kr‚óØl wyg≈Çosi≈Ç kr√≥tkƒÖ mowƒô.',
  'Mama mal‚óØje p≈Çot na bia≈Ço.',
  'Zgubi≈Çem kl‚óØcz od domu.',
  'To bardzo d‚óØgi kabel.',
  'Na podw√≥rzu stoi stary w‚óØz.',
  'Z wysokiej g‚óØry widaƒá jeziora.',
  'Ptak ma lekkie pi‚óØro.',
  'Daj kot‚óØ mleko.',
  'Nie dotykaj p≈Çot‚óØ!',
  'W rowerze pƒôk≈Ç ham‚óØlec.',
  'Podziwiam nat‚óØrƒô w parku.',
  'Upiekli≈õmy pysznego rac‚óØcha.',
  'Kupi≈Çem nowy kapel‚óØsz.',
  'RozwiƒÖzujƒô reb‚óØs.',
  'Codziennie rys‚óØjƒô zwierzƒôta.',
  'W ‚óØrodku lasu jest polana.',
  'ZimƒÖ bywa ch‚óØd i m‚óØz.',
  'Nie zap‚óØ≈∫nij siƒô na lekcjƒô.',
  'Ch≈Çopiec p‚óØjdzie do szk‚óØ≈Çy.',
  'Przed domem stoi st‚óØ≈Ç ogrodowy.'
];

/* ========== ƒÜwiczenia LOSUJƒÑCE ========== */
const ex7 = { id:'ex7', title:'üé≤ Losuj s≈Çowo', intro:'Kliknij ‚ÄûLosuj s≈Çowo‚Äù. W s≈Çowie z bazƒÖ ‚Äû√≥/u‚Äù pojawi siƒô luka na w≈Ça≈õciwƒÖ literƒô. Wpisz ‚Äî us≈Çyszysz reakcjƒô.', randomWord:true };
const ex8 = { id:'ex8', title:'üß† Losuj zdanie', intro:'Kliknij ‚ÄûLosuj zdanie‚Äù. Uzupe≈Çnij lukƒô ‚Äû√≥/u‚Äù w kontek≈õcie.', randomSentence:true };

const EX=[ex1,ex2,ex3,ex4,ex5,ex6,ex7,ex8];

/* ===================== GENEROWANIE UI ===================== */
const tabs=document.getElementById('tabs');
const view=document.getElementById('view');
const stats=document.getElementById('stats');
let current=0;

function mount(){
  tabs.innerHTML=''; view.innerHTML='';
  EX.forEach((x,i)=>{const b=document.createElement('button');b.className='tab'+(i===current?' active':' tab');b.textContent=x.title;b.onclick=()=>{current=i;mount()};tabs.appendChild(b);});
  const x=EX[current];
  const c=document.createElement('div'); c.className='exercise';
  c.innerHTML=`<p class="muted">${x.intro}</p>`;

  if(x.sentences){
    x.sentences.forEach((it,idx)=>{
      const s=document.createElement('div'); s.className='sentence'; s.innerHTML=`${idx+1}. ${it.s}`; c.appendChild(s);
      if(EX[current].explain){
        const expl=document.createElement('div'); expl.className='explain';
        const sel=document.createElement('select'); sel.className='rule'; sel.innerHTML='<option value="">‚Äî zasada ‚Äî</option><option>√≥ wymienne</option><option>√≥ niewymienne</option><option>u</option>';
        const inp=document.createElement('input'); inp.className='expl'; inp.placeholder='Twoje wyja≈õnienie (opcjonalnie)'; setSafe(inp);
        const btn=document.createElement('button'); btn.className='btn ghost'; btn.textContent='Sprawd≈∫ zdanie'; btn.onclick=()=>checkSentence(s,sel,inp);
        expl.append('Zasada:',sel,inp,btn); c.appendChild(expl);
      }
    });
  }

  if(x.wordbank){ const bank=document.createElement('ul'); bank.className='wordbank'; x.wordbank.forEach(w=>{const li=document.createElement('li'); li.textContent=w; bank.appendChild(li)}); c.appendChild(bank); }

  if(x.choose){ x.choose.forEach((q,qi)=>{ const s=document.createElement('div'); s.className='sentence'; const sel=document.createElement('select'); sel.className='rule'; sel.innerHTML='<option value="">‚Äî wybierz ‚Äî</option>'+q.opts.map((o,i)=>`<option value="${i}">${o}</option>`).join(''); const btn=document.createElement('button'); btn.className='btn ghost'; btn.textContent='Sprawd≈∫'; btn.onclick=()=>{ const good=String(q.correct)===sel.value; mark(sel,good); speak(good?PHRASES.good:PHRASES.bad); updateScore(); if(good) celebrate(); }; s.append(`${qi+1}. Wybierz wyraz z niewymiennym ‚Äû√≥‚Äù. `, sel, btn, info('opcje: '+q.opts.join(' ‚Ä¢ '))); c.appendChild(s); }); }

  if(x.defs){ const ac=document.createElement('div'); ac.id='acrostic'; ac.className='sentence'; ac.innerHTML='<b>Has≈Ço:</b> <span id="acro-letters">‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢</span>'; c.appendChild(ac); x.defs.forEach((d,di)=>{ const s=document.createElement('div'); s.className='sentence'; const input=document.createElement('input'); input.className='expl'; input.placeholder='odpowied≈∫'; setSafe(input); input.dataset.ans=d.a.toLowerCase(); input.addEventListener('input',()=>{ const good=norm(input.value)===norm(d.a); mark(input,good); if(good) speak(PHRASES.good); updateScore(); updateAcrostic(); }); s.append(`${di+1}. ${d.d} `, input); c.appendChild(s); }); }

  if(x.custom){ const s1=document.createElement('div'); s1.className='sentence'; s1.innerHTML='<b>‚Äû√≥‚Äù wymienne ‚Äî 3 przyk≈Çady:</b> '; for(let i=0;i<3;i++){ const inp=document.createElement('input'); inp.className='expl'; setSafe(inp); inp.placeholder='wyraz z ‚Äû√≥‚Äù (np. st√≥≈Ç)'; inp.oninput=()=>checkOwn(inp,true); s1.append(' ',inp); } const s2=document.createElement('div'); s2.className='sentence'; s2.innerHTML='<b>‚Äû√≥‚Äù niewymienne ‚Äî 3 przyk≈Çady:</b> '; for(let i=0;i<3;i++){ const inp=document.createElement('input'); inp.className='expl'; setSafe(inp); inp.placeholder='wyraz z ‚Äû√≥‚Äù (np. b√≥l)'; inp.oninput=()=>checkOwn(inp,false); s2.append(' ',inp); } c.append(s1,s2); }

  if(x.randomWord){
    const boxWrap=document.createElement('div'); boxWrap.className='sentence'; boxWrap.id='randWord'; boxWrap.innerHTML='Kliknij ‚ÄûLosuj s≈Çowo‚Äù.';
    const ctr=document.createElement('div'); ctr.className='inline-controls';
    const btn1=document.createElement('button'); btn1.className='btn'; btn1.textContent='Losuj s≈Çowo'; btn1.onclick=()=>randomWord();
    const btn2=document.createElement('button'); btn2.className='btn ghost'; btn2.textContent='Poka≈º odpowied≈∫'; btn2.onclick=()=>revealRandom('randWord');
    ctr.append(btn1,btn2); c.append(boxWrap,ctr);
  }

  if(x.randomSentence){
    const boxWrap=document.createElement('div'); boxWrap.className='sentence'; boxWrap.id='randSentence'; boxWrap.innerHTML='Kliknij ‚ÄûLosuj zdanie‚Äù.';
    const ctr=document.createElement('div'); ctr.className='inline-controls';
    const btn1=document.createElement('button'); btn1.className='btn'; btn1.textContent='Losuj zdanie'; btn1.onclick=()=>randomSentence();
    const btn2=document.createElement('button'); btn2.className='btn ghost'; btn2.textContent='Poka≈º odpowied≈∫'; btn2.onclick=()=>revealRandom('randSentence');
    ctr.append(btn1,btn2); c.append(boxWrap,ctr);
  }

  view.appendChild(c);

  // Live check for wszystkie pola liter + dymki z zasadƒÖ
  view.querySelectorAll('input.letter').forEach(inp=>{
    inp.addEventListener('input',()=>{
      const ok=norm(inp.value)===norm(inp.dataset.ans);
      mark(inp,ok); updateScore(); updateAcrostic();
      if(ok){ showRuleBubble(inp); speak(PHRASES.good); } else { removeBubble(inp); speak(PHRASES.bad); }
    });
  });

  updateScore(); updateAcrostic();
}

function setSafe(el){ el.setAttribute('inputmode','text'); el.setAttribute('autocapitalize','off'); el.setAttribute('autocorrect','off'); el.setAttribute('autocomplete','off'); el.setAttribute('spellcheck','false'); }
function info(txt){ const e=document.createElement('span'); e.className='mini'; e.style.marginLeft='8px'; e.textContent=txt; return e }

/* ===================== LOGIKA WSP√ìLNA ===================== */
function norm(s){return (s||'').toLowerCase().trim().replaceAll('ƒô','e').replaceAll('ƒÖ','a')}
function mark(el,ok){el.classList.remove('correct','wrong');el.classList.add(ok?'correct':'wrong')}
function updateScore(){
  const letters=[...document.querySelectorAll('input.letter')];
  const letterDone=letters.filter(i=>i.classList.contains('correct')).length;
  const chooseTotal=(EX[current].choose||[]).length;
  const chooseDone=[...view.querySelectorAll('select.rule')].filter(s=>s.dataset.marked==='1' && s.classList.contains('correct')).length;
  const total=letters.length + chooseTotal;
  const done=letterDone + chooseDone;
  stats.textContent=`Wynik: ${done} / ${total}`;
}
function checkSentence(sentenceEl, sel, inp){
  const fields=sentenceEl.querySelectorAll('input.letter');
  let okAll=true; fields.forEach(f=>{ const ok=norm(f.value)===norm(f.dataset.ans); mark(f,ok); if(!ok) okAll=false; if(ok) showRuleBubble(f); });
  if(sel){ const keys=[...fields].map(f=>f.dataset.rule); const fav=favorite(keys); const expect = fav && fav.startsWith('O_') ? (fav==='O_WYM'?'√≥ wymienne':'√≥ niewymienne') : 'u'; const good = !!sel.value && (sel.value===expect); mark(sel,good); sel.dataset.marked='1'; if(good) speak(PHRASES.good); else speak(PHRASES.bad); }
  if(inp && inp.value.trim().length>=3){ inp.classList.add('correct'); }
  if(okAll) celebrate(); updateScore();
}
function favorite(arr){ const c={}; arr.forEach(k=>{if(!k)return; c[k]=(c[k]||0)+1}); let best=null, n=0; for(const k in c){ if(c[k]>n){n=c[k]; best=k} } return best }

/* ======= Dymek z zasadƒÖ ======= */
function showRuleBubble(inp){ removeBubble(inp); const key=inp.dataset.rule||'U_NORM'; const r=RULES[key]||{t:'U',x:'litera ‚Äûu‚Äù'}; const b=document.createElement('div'); b.className='bubble'; b.innerHTML=`<b>${r.t}:</b> ${r.x}`; inp.closest('.sentence').appendChild(b); }
function removeBubble(inp){ const s=inp.closest('.sentence'); if(!s) return; const b=s.querySelector('.bubble'); if(b) b.remove(); }

/* ===================== LOSOWANIE ===================== */
function rint(n){ return Math.floor(Math.random()*n) }
function pick(arr){ return arr[rint(arr.length)] }

function randomWord(){
  const poolType = Math.random()<.5 ? 'O' : 'U';
  const word = poolType==='O' ? pick(WORDS_O_CLEAN) : pick(WORDS_U);
  const letter = poolType==='O' ? '√≥' : 'u';
  const idx = word.indexOf(letter);
  if(idx<0){ return randomWord(); }
  const before = word.slice(0,idx); const after = word.slice(idx+1);
  const rule = poolType==='O' ? 'O_NORM' : 'U_NORM';
  const html = `${before}${box(letter, poolType==='O'?'O_NIEW':'U_NORM')}${after}`;
  const s=document.getElementById('randWord'); s.innerHTML = html;
  attachLiveLetters(s);
}

function randomSentence(){
  const src = pick(RAND_SENTENCES);
  // je≈ºeli zdanie zawiera ‚Äû‚óØ‚Äù, wybieramy literƒô na podstawie najbli≈ºszych znak√≥w (heurystyka)
  const needO = /p‚óØ≈Ç|r‚óØb|w‚óØz|g‚óØr|pi‚óØr|kr‚óØl|st‚óØ≈Ç|dw‚óØr|ch‚óØr|mr‚óØz|w≈õr‚óØd/i.test(src);
  const letter = needO ? '√≥' : 'u';
  const ruleKey = needO ? 'O_NIEW' : 'U_NORM';
  const html = src.replace('‚óØ', box(letter, ruleKey));
  const s=document.getElementById('randSentence'); s.innerHTML = html;
  attachLiveLetters(s);
}

function revealRandom(id){
  const wrap=document.getElementById(id); if(!wrap) return;
  const inp=wrap.querySelector('input.letter'); if(!inp) return;
  inp.value = inp.dataset.ans; mark(inp,true); showRuleBubble(inp); speak(PHRASES.good); updateScore();
}

function attachLiveLetters(scope){
  scope.querySelectorAll('input.letter').forEach(inp=>{
    inp.addEventListener('input',()=>{
      const ok=norm(inp.value)===norm(inp.dataset.ans);
      mark(inp,ok);
      if(ok){ showRuleBubble(inp); celebrate(); speak(PHRASES.good); } else { removeBubble(inp); speak(PHRASES.bad); }
      updateScore();
    });
  });
}

/* ===================== AUDIO / UI ===================== */
const PHRASES = { good:'Jeste≈õ profesorek!', bad:'Jeste≈õ os≈Çem!' };
let ac; function audio(){ if(!ac) ac=new (window.AudioContext||window.webkitAudioContext)(); return ac }
function beep(freq=640,ms=120){const ctx=audio();const o=ctx.createOscillator();const g=ctx.createGain();o.type='sine';o.frequency.value=freq;o.connect(g);g.connect(ctx.destination);g.gain.value=.15;o.start();setTimeout(()=>o.stop(),ms)}
function speak(text){ const s=window.speechSynthesis; if(!s||!text) return; const u=new SpeechSynthesisUtterance(text); u.lang='pl-PL'; u.rate=1.02; s.speak(u) }
const toast=document.getElementById('toast'); function note(msg){ toast.textContent=msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1600) }

// konfetti
const canvas=document.getElementById('confetti');const ctx2=canvas.getContext('2d');let conf=[];function resize(){canvas.width=innerWidth;canvas.height=innerHeight}addEventListener('resize',resize);resize();
function celebrate(){ for(let i=0;i<70;i++) conf.push({x:Math.random()*canvas.width,y:-10,v:2+Math.random()*3,s:4+Math.random()*6,r:Math.random()*6,c:`hsl(${Math.random()*360},100%,60%)`}); (function loop(){ ctx2.clearRect(0,0,canvas.width,canvas.height); conf.forEach(p=>{p.y+=p.v;p.x+=Math.sin(p.y/20);p.r+=.1;ctx2.save();ctx2.translate(p.x,p.y);ctx2.rotate(p.r);ctx2.fillStyle=p.c;ctx2.fillRect(-p.s/2,-p.s/2,p.s,p.s);ctx2.restore();}); conf=conf.filter(p=>p.y<canvas.height+20); if(conf.length) requestAnimationFrame(loop); })(); beep(880); setTimeout(()=>beep(660),120); setTimeout(()=>beep(520),220) }

// przyciski
 document.getElementById('checkAll').onclick=()=>{
   view.querySelectorAll('.sentence').forEach((s)=>{
     const sel=s.nextElementSibling && s.nextElementSibling.querySelector('select.rule');
     const inp=s.nextElementSibling && s.nextElementSibling.querySelector('input.expl');
     checkSentence(s,sel,inp);
   });
 };
 document.getElementById('resetAll').onclick=()=>{
   view.querySelectorAll('input').forEach(i=>{ if(i.type==='text'){ i.value=''; i.classList.remove('correct','wrong'); }});
   view.querySelectorAll('select').forEach(s=>{ s.value=''; s.classList.remove('correct','wrong'); s.dataset.marked='0'});
   view.querySelectorAll('.bubble').forEach(b=>b.remove());
   updateScore();
 };
 document.getElementById('share').onclick=async()=>{ try{ await navigator.clipboard.writeText(location.href); note('Skopiowano adres strony'); }catch(e){ note('Skopiuj URL z paska adresu') } };

/* ===================== INICJALIZACJA ===================== */
mount();

function updateAcrostic(){ const wrap=document.getElementById('acrostic'); if(!wrap) return; const inputs=[...view.querySelectorAll('#acrostic ~ .sentence input.expl')]; const letters=inputs.map(i=> (i.value.trim()[0]||'‚Ä¢').toUpperCase()); const out=document.getElementById('acro-letters'); if(out) out.textContent=letters.join(' '); }
</script>
</body>
</html>
